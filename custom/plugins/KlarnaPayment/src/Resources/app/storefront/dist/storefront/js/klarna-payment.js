(window.webpackJsonp=window.webpackJsonp||[]).push([["klarna-payment"],{Refz:function(t,e,n){"use strict";n.r(e);var o=n("FGIj"),a=n("3xtq"),r=n("u0Tz"),i=n("gHbT");function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function u(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var p,h,y,m=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,c(e).apply(this,arguments))}var n,o,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(e,t),n=e,(o=[{key:"init",value:function(){this.el&&(this._showElement("klarnaConfirmFormSubmit"),this.options.paymentCategory&&this._disableSubmitButton(),this._createScript())}},{key:"_createScript",value:function(){var t=document.createElement("script");t.type="text/javascript",t.src=this.options.url,t.addEventListener("load",this._handleScriptLoaded.bind(this),!1),document.head.appendChild(t)}},{key:"_handleScriptLoaded",value:function(){try{Klarna.Payments.init({client_token:this.options.clientToken})}catch(t){return this._hideElement("klarnaPaymentsContainer"),this._showElement("klarnaUnavailableError"),void this._disableSubmitButton()}var t=this;if(this.options.paymentCategory){var e=i.a.querySelector(document,".klarna-payment");r.a.create(e),t._hideElement("klarnaPaymentsContainer"),t._emptyElement("klarnaPaymentsContainer"),t._disableSubmitButton();try{Klarna.Payments.load({container:"#klarnaPaymentsContainer",payment_method_category:this.options.paymentCategory},(function(n){n.show_form?(t._showElement("klarnaPaymentsContainer"),t._hideElement("klarnaUnavailableError"),t._enableSubmitButton()):(t._hideElement("klarnaPaymentsContainer"),t._showElement("klarnaUnavailableError")),r.a.remove(e)}))}catch(e){t._hideElement("klarnaPaymentsContainer"),t._showElement("klarnaUnavailableError")}}this._handlePaymentMethodModal(),this._registerEvents()}},{key:"_registerEvents",value:function(){var t=this;document.getElementById("confirmOrderForm").addEventListener("submit",t._handleOrderSubmit.bind(this));var e=document.querySelectorAll("[name='paymentMethodId']");Array.prototype.forEach.call(e,(function(e){e.addEventListener("change",t._handlePaymentMethodChange.bind(t))}))}},{key:"_handlePaymentMethodChange",value:function(t){this._hideElements("klarnaPaymentsContainerModal"),this.getKlarnaCodeFromPaymentMethod(t.target.value)&&this._showElement("klarnaPaymentsContainerModal".concat(t.target.value))}},{key:"_handlePaymentMethodModal",value:function(){var t=this,e=document.querySelectorAll(".klarna-payment-method");Array.prototype.forEach.call(e,(function(e){var n=e.getAttribute("id"),o=t.getKlarnaCodeFromPaymentMethod(n);try{Klarna.Payments.load({container:"#klarnaPaymentsContainerModal".concat(n),payment_method_category:o,instance_id:n},(function(e){e.show_form||t._hideElement(n)}))}catch(e){t._hideElement(n)}}))}},{key:"_hideElements",value:function(t){var e=document.getElementsByClassName(t);Array.prototype.forEach.call(e,(function(t){t.hidden=!0}))}},{key:"_hideElement",value:function(t){var e=document.getElementById(t);e&&(e.hidden=!0)}},{key:"_showElement",value:function(t){var e=document.getElementById(t);e&&(e.hidden=!1)}},{key:"_emptyElement",value:function(t){var e=document.getElementById(t);e&&(e.innerHTML="")}},{key:"getKlarnaCodeFromPaymentMethod",value:function(t){var e=document.getElementById(t);return e?e.getAttribute("data-klarna-code"):""}},{key:"_disableSubmitButton",value:function(){var t=document.getElementById("confirmFormSubmit");t&&t.setAttribute("disabled","disabled")}},{key:"_enableSubmitButton",value:function(){var t=document.getElementById("confirmFormSubmit");t&&t.removeAttribute("disabled")}},{key:"_moveKlarnaModalContainer",value:function(t){var e=document.getElementById("klarnaModalContainer");t.parentElement.appendChild(e)}},{key:"_handleOrderSubmit",value:function(t){this.options.paymentCategory&&(this.authorization||(t.preventDefault(),a.a.create(),this._createAuthorization()))}},{key:"_createAuthorization",value:function(){var t=this;try{Klarna.Payments.authorize({auto_finalize:!0,payment_method_category:this.options.paymentCategory},t.options.customerData,(function(e){e.show_form||(t._hideElement("klarnaPaymentsContainer"),t._showElement("klarnaUnavailableError")),e.approved?(t._saveAuthorization(e),t._submitConfirmForm()):a.a.remove()}))}catch(e){t._hideElement("klarnaPaymentsContainer"),t._showElement("klarnaUnavailableError")}}},{key:"_saveAuthorization",value:function(t){this.authorization=t.authorization_token,this._addAuthorizationToForm(this.authorization)}},{key:"_addAuthorizationToForm",value:function(t){var e=document.getElementById("klarnaAuthorizationToken");e&&(e.value=t)}},{key:"_submitConfirmForm",value:function(){var t=document.getElementById("confirmOrderForm");t&&t.submit()}}])&&l(n.prototype,o),s&&l(n,s),e}(o.a);y={url:"https://x.klarnacdn.net/kp/lib/v1/api.js",clientToken:"",paymentCategory:"",customerData:""},(h="options")in(p=m)?Object.defineProperty(p,h,{value:y,enumerable:!0,configurable:!0,writable:!0}):p[h]=y;var f=n("k8s9");function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var w=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,g(e).apply(this,arguments))}var n,o,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,t),n=e,a=[{key:"create",value:function(t){t.classList.add("has-element-loader"),r.a.exists(t)||(e.appendLoader(t),setTimeout((function(){var e=t.querySelector(".".concat("element-loader-backdrop"));e&&e.classList.add("element-loader-backdrop-open")}),1))}},{key:"getTemplate",value:function(){return'\n        <div class="'.concat("element-loader-backdrop",' klarna-loading-indicator">\n            <div class="loader" role="status">\n                <span class="sr-only">Loading...</span>\n            </div>\n        </div>\n        ')}},{key:"appendLoader",value:function(t){t.insertAdjacentHTML("beforeend",e.getTemplate())}}],(o=null)&&b(n.prototype,o),a&&b(n,a),e}(r.a);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function I(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e){return(P=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function O(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var T=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,C(e).apply(this,arguments))}var o,a,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&P(t,e)}(e,t),o=e,(a=[{key:"init",value:function(){if(this.el){try{this.httpClient=new(n("p4AR").default)}catch(t){this.httpClient=new f.a(window.accessKey,window.contextToken)}this._createScript()}}},{key:"_createScript",value:function(){if(document.querySelectorAll('script[src="'.concat(this.options.libraryUrl,'"]')).length>0)this._onKlarnaLoad();else{var t=document.createElement("script");t.type="text/javascript",t.src=this.options.libraryUrl,t.addEventListener("load",this._onKlarnaLoad.bind(this),!1),document.head.appendChild(t)}}},{key:"_registerKlarnaEvents",value:function(){var t=this;Klarna.InstantShopping.on("buy_button_clicked",(function(e){t._initializeWidget(e)}),{setup:{instance_id:t.options.instanceId}}),Klarna.InstantShopping.on("shipping_updated",(function(e){t._updateShipping(e)}),{setup:{instance_id:t.options.instanceId}}),Klarna.InstantShopping.on("identification_updated",(function(e){t._updateIdentification(e)}),{setup:{instance_id:t.options.instanceId}}),Klarna.InstantShopping.on("session_initiated",(function(e){t._initiateSession(e)}),{setup:{instance_id:t.options.instanceId}})}},{key:"_initializeWidget",value:function(){var t=this,e=this.options.actionUrls.updateDataUrl;e&&(this.showLoadingIndicator(window.document.body),this.httpClient.post(e,JSON.stringify({productId:this.options.detailPageProductId,productQuantity:this.getProductQuantity(this.options.detailPageProductId)}),(function(e){var n=JSON.parse(e),o=JSON.parse(n.merchant_data||"{}");n.setup={instance_id:t.options.instanceId},Klarna.InstantShopping.update(n,(function(e){w.remove(window.document.body),e.show_button||t.el.parentNode.removeChild(t.el),t.cartToken=o.klarna_cart_token}))})))}},{key:"_updateIdentification",value:function(t){var e=this,n=this.options.actionUrls.updateIdentificationUrl;n&&(this.showLoadingIndicator(window.document.body),this.httpClient.post(n,JSON.stringify({country:t.customer_country,postal_code:t.customer_postal_code,cartToken:e.cartToken}),(function(t){var n=JSON.parse(t);if(n.status&&"error"===n.status)return e.el.parentNode.removeChild(e.el),void w.remove(window.document.body);n.setup={instance_id:e.options.instanceId},Klarna.InstantShopping.update(n,(function(t){w.remove(window.document.body),t.show_button||e.el.parentNode.removeChild(e.el)}))})))}},{key:"_updateShipping",value:function(t){var e=this,n=this.options.actionUrls.updateShippingUrl;n&&(this.showLoadingIndicator(window.document.body),this.httpClient.post(n,JSON.stringify({shippingMethodId:t.customer_selected_shipping_option.reference,country:t.customer_country,postal_code:t.customer_postal_code,cartToken:e.cartToken}),(function(t){var n=JSON.parse(t);if(n.status&&"error"===n.status)return e.el.parentNode.removeChild(e.el),void w.remove(window.document.body);var o=JSON.parse(n.merchant_data||"{}");e.cartToken=o.klarna_cart_token,n.setup={instance_id:e.options.instanceId},Klarna.InstantShopping.update(n,(function(t){w.remove(window.document.body),t.show_button||e.el.parentNode.removeChild(e.el)}))})))}},{key:"_initiateSession",value:function(t){var e=this,n=this,o=this.options.actionUrls.initiateSessionUrl;o&&(void 0!==n.cartToken?(this.showLoadingIndicator(window.document.body),this.httpClient.post(o,JSON.stringify({country:t.customer_country,postal_code:t.customer_postal_code,cartToken:n.cartToken}),(function(t){var e=JSON.parse(t);if(e.status&&"error"===e.status)return n.el.parentNode.removeChild(n.el),void w.remove(window.document.body);e.setup={instance_id:n.options.instanceId},Klarna.InstantShopping.update(e,(function(t){w.remove(window.document.body),t.show_button||n.el.parentNode.removeChild(n.el)}))}))):setTimeout((function(){e._initiateSession(t)}),250))}},{key:"_onKlarnaLoad",value:function(){var t=this;Klarna.InstantShopping.load(this.getKlarnaRequestData(),(function(e){e.show_button?(t.el.style.display="block",t._registerKlarnaEvents()):t.el.parentNode.removeChild(t.el)}))}},{key:"showLoadingIndicator",value:function(t){document.getElementById(this.options.selectors.klarnaModalSelector).style.zIndex="1500",w.create(t)}},{key:"getKlarnaRequestData",value:function(){return{setup:{instance_id:this.options.instanceId,key:this.options.buttonKey,environment:this.options.environment,region:"eu"},purchase_country:this.options.countryIso,purchase_currency:this.options.currencyIso,billing_countries:this.options.billingCountries,locale:this.options.klarnaLocale,merchant_urls:this.options.merchantUrls,order_lines:this.options.orderLines,styling:{theme:{variation:this.options.theme.variation,type:this.options.theme.type}}}}},{key:"getProductQuantity",value:function(t){if(!t)return 1;var e=document.querySelector('select[name="lineItems['.concat(t,'][quantity]"]'));return e&&parseInt(e.options[e.selectedIndex].value,10)>0?parseInt(e.options[e.selectedIndex].value,10):1}}])&&E(o.prototype,a),r&&E(o,r),e}(o.a);O(T,"options",{buttonKey:"",environment:"playground",countryIso:"",currencyIso:"",billingCountries:[],instanceId:"",klarnaLocale:"",libraryUrl:"https://x.klarnacdn.net/instantshopping/lib/v1/lib.js",merchantUrls:{},orderLines:{},theme:{variation:"dark",type:"express"},actionUrls:{initiateSessionUrl:"",updateDataUrl:"",updateIdentificationUrl:"",updateShippingUrl:""},selectors:{klarnaModalSelector:"klarna-instant-shopping-fullscreen"},detailPageProductId:""}),O(T,"cartToken",void 0),window.PluginManager.register("KlarnaPayments",m,"[data-is-klarna-payments]"),window.PluginManager.register("KlarnaInstantShopping",T,"[data-is-klarna-instant-shopping]")}},[["Refz","runtime","vendor-node","vendor-shared"]]]);